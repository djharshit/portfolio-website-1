# ---------------------------------------------------
# Workflow Name (shown in GitHub Actions UI)
# ---------------------------------------------------
name: Deploy static content to Pages

# ---------------------------------------------------
# Triggers
# - Runs automatically on push to master
# - Can also be triggered manually from Actions tab
# ---------------------------------------------------
on:
  push:
    branches: ["master"]
  workflow_dispatch:

# ---------------------------------------------------
# Required permissions for GitHub Pages deployment
# ---------------------------------------------------
permissions:
  contents: read        # Read repository content
  pages: write          # Deploy to GitHub Pages
  id-token: write       # Required for OIDC authentication

# ---------------------------------------------------
# Prevent overlapping deployments
# Only one Pages deployment runs at a time
# ---------------------------------------------------
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    # -------------------------------------------------
    # Environment configuration
    # The URL is automatically populated after deploy
    # -------------------------------------------------
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    # -------------------------------------------------
    # Runner
    # -------------------------------------------------
    runs-on: ubuntu-latest

    steps:
      # -----------------------------------------------
      # Step 1: Checkout repository code
      # -----------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # -----------------------------------------------
      # Step 2: Configure GitHub Pages
      # Sets up Pages environment and metadata
      # -----------------------------------------------
      - name: Setup GitHub Pages
        uses: actions/configure-pages@v5

      # -----------------------------------------------
      # Step 3: Upload static files as a Pages artifact
      # -----------------------------------------------
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'   # Root directory containing static site files

      # -----------------------------------------------
      # Step 4: Deploy artifact to GitHub Pages
      # -----------------------------------------------
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
